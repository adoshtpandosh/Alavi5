<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>پنل مدیریت - دنیای سیلندر علوی</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../css/vazir.css">
  <style>body{font-family:Vazir,system-ui;}</style>
</head>

<body class="bg-slate-50">
<script>if(!localStorage.getItem('admin')) location.href='login.html';</script>

<header class="bg-purple-600 text-white p-4 shadow">
  <h1 class="text-xl font-bold">پنل مدیریت - دنیای سیلندر علوی</h1>
</header>

<main class="container mx-auto p-4 space-y-8">
  <!-- آپلود اکسل -->
  <section class="bg-white rounded-xl shadow p-6">
    <h2 class="text-lg font-bold mb-3 text-purple-700">آپلود فایل اکسل جدید</h2>
    <input type="file" id="excelFile" accept=".xlsx,.xls,.csv" class="mb-3">
    <button onclick="uploadExcel()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">آپلود و جایگزین</button>
    <p id="msgExcel" class="mt-2 text-sm"></p>
  </section>

  <!-- ویرایش متن درباره‌ما -->
  <section class="bg-white rounded-xl shadow p-6">
    <h2 class="text-lg font-bold mb-3 text-purple-700">ویرایش متن درباره ما</h2>
    <textarea id="aboutEditor" rows="8" class="w-full border rounded p-2 text-sm"></textarea>
    <button onclick="saveAbout()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">ذخیره متن</button>
    <p id="msgAbout" class="mt-2 text-sm"></p>
  </section>
</main>

<script>
/* ---------- بارگذاری درباره‌ما ---------- */
fetch('../data/about.txt')
  .then(r => r.text())
  .then(t => document.getElementById('aboutEditor').value = t);

/* ---------- ذخیره درباره‌ما ---------- */
function saveAbout() {
  const text = document.getElementById('aboutEditor').value;
  fetch('../api/save-about.php',{
    method: 'POST',
    headers: {'Content-Type':'application/x-www-form-urlencoded'},
    body: 'text=' + encodeURIComponent(text)
  })
  .then(r => r.json())
  .then(res => document.getElementById('msgAbout').textContent = res.message || 'ذخیره شد');
}

/* ---------- آپلود اکسل ---------- */
function uploadExcel() {
  const inp = document.getElementById('excelFile');
  if (!inp.files.length) return;
  const file = inp.files[0];
  const msg = document.getElementById('msgExcel');
  msg.textContent = 'در حال آپلود...';

  const form = new FormData();
  form.append('file', file, 'products.xlsx');

  fetch('../api/save-excel.php',{method:'POST',body:form})
    .then(r => r.json())
    .then(res => msg.textContent = res.message || 'آپلود و جایگزین شد');
}
</script>
</body>
</html>